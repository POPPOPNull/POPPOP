<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ohgiraffers.poppop.behavior.model.dao.BehaviorMapper">
    <resultMap id="behaviorResultMap" type="com.ohgiraffers.poppop.behavior.model.dto.BehaviorDTO">
        <id property="no"   column="event_data_no"/>
        <result property="sessionId" column="session_id"/>
        <result property="eventType" column="eventType"/>
        <result property="eventValue" column="eventValue"/>
        <result property="timeStamp" column="timeStamp"/>
    </resultMap>

    <!--리뷰 로그 수집-->
    <insert id="insertLogByReview">
        insert into user_event_data
        (
        event_type,
        event_value,
        session_id,
        time_stamp,
        popup_no
        )
        value
        (
        "후기 작성",
        #{popupNo},
        #{sessionId},
        now(),
        #{popupNo}
        )
    </insert>
    <!--관심목록 추가 로그 수집-->
    <insert id="insertLogByFavorite">
        insert into user_event_data
        (
        event_type,
        event_value,
        session_id,
        time_stamp,
        popup_no
        )
        value
        (
        "관심목록 추가",
        #{popupNo},
        #{sessionId},
        now(),
        #{popupNo}
        )
    </insert>
    <!--클릭 로그 수집-->
    <insert id="logDataByClick">
        insert into user_event_data
        (
        event_type,
        event_value,
        session_id,
        time_stamp,
        popup_no
        )
        value
        (
        "상세페이지 클릭",
        #{popupNo},
        #{sessionId},
        now(),
        #{popupNo}
        )
    </insert>
    <!--노출 로그 수집-->
    <insert id="logDataBySelect">
        insert into user_event_data
        (
        event_type,
        event_value,
        session_id,
        time_stamp,
        popup_no
        )
        value
        <foreach collection="popupNoList" item="popupNo" separator=",">
            (
            "노출",
            #{popupNo},
            #{sessionId},
            now(),
            #{popupNo}
            )
        </foreach>
    </insert>
    <!--예약 로그 수집-->
    <insert id="insertLogByReservation">
        insert into user_event_data
        (
        event_type,
        event_value,
        session_id,
        time_stamp,
        popup_no
        )
        value
        (
        "예약",
        #{popupNo},
        #{sessionId},
        now(),
        #{popupNo}
        )
    </insert>

    <insert id="logSearchWord">
        insert into user_event_data
        (
        event_type,
        event_value,
        session_id,
        time_stamp
        )
        value
        (
        "검색",
        #{searchWord},
        #{sessionId},
        now()
        )
    </insert>

    <!--조회 수 조회-->
    <select id="countViews" resultType="_int">
        select
               count(*)
               from user_event_data
               where event_type="상세페이지 클릭"
               and event_value=#{eventValue}
    </select>

    <!--찜 수 조회-->
    <select id="countFavorite" resultType="_int">
        select
        count(*)
        from user_event_data
        where event_type="관심목록 추가"
        and event_value=#{eventValue}
    </select>
</mapper>